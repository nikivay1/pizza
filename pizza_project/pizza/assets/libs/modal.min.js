/*
 * @license
 * angular-modal v0.5.0
 * (c) 2013 Brian Ford http://briantford.com
 * License: MIT
 */
"use strict";
function modalFactoryFactory(e, t, n, r, o, a, l) {
    /**
     * @description
     * Модальное окно
     * @param c
     * c.template: HTML шаблона.
     * c.templateUrl: url-адрес для HTML-шаблона.
     * c.zIndex: z-index для модального окна.
     */
    function modalHandler(c) {
        function u() {
            return p.then(function (t) {
                v || i(t, e);
                promise = o.defer();
                angular.element('body').addClass('popup-visible');
                return promise.promise;
            })
        }

        function i(o, a) {
            if (f()) {
                return;
            }
            if (v = angular.element(o), 0 === v.length)throw new Error("The template contains no elements; you need to wrap text nodes");
            v.css('z-index', zIndex);
            if (d = n.$new(), h) {
                a || (a = {}), a.$scope = d;
                var l = r(h, a);
                $ && (d[$] = l)
            } else if (a)for (var c in a)d[c] = a[c];
            return t(v)(d), e.enter(v, s)
        }

        function m(result) {
            return v ? e.leave(v).then(function () {
                d.$destroy(), d = null, v.remove(), v = null;
                angular.element('body').removeClass('popup-visible');
                return promise.resolve(result)
            }) : function() { promise.resolve(result) }
        }

        function f() {
            return !!v
        }

        var wrapTpl = function(tplUrl) {
            return o.when(l.get(tplUrl)).then(function(tpl) {
                return '<div class="btf-modal-wrapper"><div class="btf-modal"><div class="btf-modal-container">' + tpl + '<div class="overlay" ng-click="closeDialog()"></div></div></div></div>';
            });
        }

        if (!(!c.template ^ !c.templateUrl))throw new Error("Expected modal to have exacly one of either `template` or `templateUrl`");
        var p, d, h = (c.template, c.controller || null), $ = c.controllerAs,
            s = angular.element(c.container || document.body), v = null,
            zIndex = c.zIndex || 2000, promise = null;
        p = wrapTpl(c.templateUrl)
        return {activate: u, deactivate: m, active: f};
    }

    return modalHandler;
}
angular.module("btford.modal", []).factory("btfModal", ["$animate", "$compile", "$rootScope", "$controller", "$q", "$http", "$templateCache", modalFactoryFactory]);
